"use strict";(self.webpackChunkmy_app=self.webpackChunkmy_app||[]).push([[100],{100:(e,t,r)=>{r.r(t),r.d(t,{SandpackNode:()=>ce});var n=r(652);function i(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}function o(e){var t=function(e,t){if("object"!==s(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==s(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===s(t)?t:String(t)}function a(e,t,r){return(t=o(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function c(e,t,r){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return r}function l(e,t,r){if(!t.has(e))throw new TypeError("attempted to "+r+" private field on non-instance");return t.get(e)}function d(e,t){return function(e,t){return t.get?t.get.call(e):t.value}(e,l(e,t,"get"))}function h(e,t,r){return function(e,t,r){if(t.set)t.set.call(e,r);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=r}}(e,l(e,t,"set"),r),r}var u=Object.create,p=Object.defineProperty,f=Object.getOwnPropertyDescriptor,m=Object.getOwnPropertyNames,v=Object.getPrototypeOf,w=Object.prototype.hasOwnProperty,y=(e,t)=>function(){return t||(0,e[m(e)[0]])((t={exports:{}}).exports,t),t.exports},g=(e,t,r)=>(r=null!=e?u(v(e)):{},((e,t,r,n)=>{if(t&&"object"===typeof t||"function"===typeof t)for(let i of m(t))w.call(e,i)||i===r||p(e,i,{get:()=>t[i],enumerable:!(n=f(t,i))||n.enumerable});return e})(!t&&e&&e.__esModule?r:p(r,"default",{value:e,enumerable:!0}),e)),b=(e,t,r)=>(((e,t,r)=>{t in e?p(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r})(e,"symbol"!==typeof t?t+"":t,r),r),P=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)},_=(e,t,r)=>(P(e,t,"read from private field"),r?r.call(e):t.get(e)),E=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},S=(e,t,r,n)=>(P(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r),j=(e,t,r)=>(P(e,t,"access private method"),r),k=y({"../../node_modules/.pnpm/cuid@2.1.8/node_modules/cuid/lib/pad.js"(e,t){t.exports=function(e,t){var r="000000000"+e;return r.substr(r.length-t)}}}),L=y({"../../node_modules/.pnpm/cuid@2.1.8/node_modules/cuid/lib/fingerprint.browser.js"(e,t){var r=k(),n="object"===typeof window?window:self,i=Object.keys(n).length,s=r(((navigator.mimeTypes?navigator.mimeTypes.length:0)+navigator.userAgent.length).toString(36)+i.toString(36),4);t.exports=function(){return s}}}),I=y({"../../node_modules/.pnpm/cuid@2.1.8/node_modules/cuid/lib/getRandomValue.browser.js"(e,t){var r,n,i="undefined"!==typeof window&&(window.crypto||window.msCrypto)||"undefined"!==typeof self&&self.crypto;i?(n=Math.pow(2,32)-1,r=function(){return Math.abs(i.getRandomValues(new Uint32Array(1))[0]/n)}):r=Math.random,t.exports=r}}),C=y({"../../node_modules/.pnpm/cuid@2.1.8/node_modules/cuid/index.js"(e,t){var r=L(),n=k(),i=I(),s=0,o=Math.pow(36,4);function a(){return n((i()*o<<0).toString(36),4)}function c(){return s=s<o?s:0,++s-1}function l(){return"c"+(new Date).getTime().toString(36)+n(c().toString(36),4)+r()+(a()+a())}l.slug=function(){var e=(new Date).getTime().toString(36),t=c().toString(36).slice(-4),n=r().slice(0,1)+r().slice(-1),i=a().slice(-2);return e.slice(-2)+t+n+i},l.isCuid=function(e){return"string"===typeof e&&!!e.startsWith("c")},l.isSlug=function(e){if("string"!==typeof e)return!1;var t=e.length;return t>=7&&t<=10},l.fingerprint=r,t.exports=l}}),x=y({"../../node_modules/.pnpm/@open-draft+deferred-promise@2.1.0/node_modules/@open-draft/deferred-promise/build/createDeferredExecutor.js"(e){Object.defineProperty(e,"__esModule",{value:!0}),e.createDeferredExecutor=void 0,e.createDeferredExecutor=function(){const e=(t,r)=>{e.state="pending",e.resolve=r=>{if("pending"!==e.state)return;e.result=r;return t(r instanceof Promise?r:Promise.resolve(r).then((t=>(e.state="fulfilled",t))))},e.reject=t=>{if("pending"===e.state)return queueMicrotask((()=>{e.state="rejected"})),r(e.rejectionReason=t)}};return e}}}),M=y({"../../node_modules/.pnpm/@open-draft+deferred-promise@2.1.0/node_modules/@open-draft/deferred-promise/build/DeferredPromise.js"(e){var t,r;Object.defineProperty(e,"__esModule",{value:!0}),e.DeferredPromise=void 0;var n=x(),s=(t=new WeakMap,r=new WeakSet,class extends Promise{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const s=(0,n.createDeferredExecutor)();var o,c;super(((t,r)=>{s(t,r),null===e||void 0===e||e(s.resolve,s.reject)})),i(o=this,c=r),c.add(o),function(e,t,r){i(e,t),t.set(e,r)}(this,t,{writable:!0,value:void 0}),a(this,"resolve",void 0),a(this,"reject",void 0),h(this,t,s),this.resolve=d(this,t).resolve,this.reject=d(this,t).reject}get state(){return d(this,t).state}get rejectionReason(){return d(this,t).rejectionReason}then(e,t){return c(this,r,o).call(this,super.then(e,t))}catch(e){return c(this,r,o).call(this,super.catch(e))}finally(e){return c(this,r,o).call(this,super.finally(e))}});function o(e){return Object.defineProperties(e,{resolve:{configurable:!0,value:this.resolve},reject:{configurable:!0,value:this.reject}})}e.DeferredPromise=s}}),F=y({"../../node_modules/.pnpm/@open-draft+deferred-promise@2.1.0/node_modules/@open-draft/deferred-promise/build/index.js"(e){var t=e&&e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),r=e&&e.__exportStar||function(e,r){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(r,n)||t(r,e,n)};Object.defineProperty(e,"__esModule",{value:!0}),r(x(),e),r(M(),e)}}),O=y({"../../node_modules/.pnpm/strict-event-emitter@0.4.3/node_modules/strict-event-emitter/lib/MemoryLeakError.js"(e){Object.defineProperty(e,"__esModule",{value:!0}),e.MemoryLeakError=void 0;var t=class extends Error{constructor(e,t,r){super("Possible EventEmitter memory leak detected. ".concat(r," ").concat(t.toString()," listeners added. Use emitter.setMaxListeners() to increase limit")),a(this,"emitter",void 0),a(this,"type",void 0),a(this,"count",void 0),this.emitter=e,this.type=t,this.count=r,this.name="MaxListenersExceededWarning"}};e.MemoryLeakError=t}}),A=y({"../../node_modules/.pnpm/strict-event-emitter@0.4.3/node_modules/strict-event-emitter/lib/Emitter.js"(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Emitter=void 0;var t,r,n,i,s,o,a,c,l,d,h,u=O(),p=class{constructor(){E(this,i),E(this,o),E(this,c),E(this,d),E(this,t,void 0),E(this,r,void 0),E(this,n,void 0),S(this,t,new Map),S(this,r,p.defaultMaxListeners),S(this,n,!1)}static listenerCount(e,t){return e.listenerCount(t)}setMaxListeners(e){return S(this,r,e),this}getMaxListeners(){return _(this,r)}eventNames(){return Array.from(_(this,t).keys())}emit(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];const o=j(this,i,s).call(this,e);return o.forEach((e=>{e.apply(this,r)})),o.length>0}addListener(e,o){j(this,d,h).call(this,"newListener",e,o);const a=j(this,i,s).call(this,e).concat(o);if(_(this,t).set(e,a),_(this,r)>0&&this.listenerCount(e)>_(this,r)&&!_(this,n)){S(this,n,!0);const t=new u.MemoryLeakError(this,e,this.listenerCount(e));console.warn(t)}return this}on(e,t){return this.addListener(e,t)}once(e,t){return this.addListener(e,j(this,c,l).call(this,e,t))}prependListener(e,r){const n=j(this,i,s).call(this,e);if(n.length>0){const i=[r].concat(n);_(this,t).set(e,i)}else _(this,t).set(e,n.concat(r));return this}prependOnceListener(e,t){return this.prependListener(e,j(this,c,l).call(this,e,t))}removeListener(e,r){const n=j(this,i,s).call(this,e);return n.length>0&&(j(this,o,a).call(this,n,r),_(this,t).set(e,n),j(this,d,h).call(this,"removeListener",e,r)),this}off(e,t){return this.removeListener(e,t)}removeAllListeners(e){return e?_(this,t).delete(e):_(this,t).clear(),this}listeners(e){return Array.from(j(this,i,s).call(this,e))}listenerCount(e){return j(this,i,s).call(this,e).length}rawListeners(e){return this.listeners(e)}},f=p;t=new WeakMap,r=new WeakMap,n=new WeakMap,i=new WeakSet,s=function(e){return _(this,t).get(e)||[]},o=new WeakSet,a=function(e,t){const r=e.indexOf(t);return r>-1&&e.splice(r,1),[]},c=new WeakSet,l=function(e,t){var r=this;const n=function(){r.removeListener(e,n);for(var i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];t.apply(r,s)};return n},d=new WeakSet,h=function(e,t,r){this.emit(e,t,r)},b(f,"defaultMaxListeners",10),e.Emitter=f}}),D=y({"../../node_modules/.pnpm/strict-event-emitter@0.4.3/node_modules/strict-event-emitter/lib/index.js"(e){var t=e&&e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),r=e&&e.__exportStar||function(e,r){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(r,n)||t(r,e,n)};Object.defineProperty(e,"__esModule",{value:!0}),r(A(),e),r(O(),e)}}),T=g(C()),U=/(%?)(%([sdjo]))/g;function R(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];if(0===r.length)return e;let i=0,s=e.replace(U,((e,t,n,s)=>{const o=function(e,t){switch(t){case"s":return e;case"d":case"i":return Number(e);case"j":return JSON.stringify(e);case"o":{if("string"===typeof e)return e;const t=JSON.stringify(e);return"{}"===t||"[]"===t||/^\[object .+?\]$/.test(t)?e:t}}}(r[i],s);return t?e:(i++,o)}));return i<r.length&&(s+=" ".concat(r.slice(i).join(" "))),s=s.replace(/%{2,2}/g,"%"),s}var W=class extends Error{constructor(e){super(e),this.message=e,this.name="Invariant Violation";for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];this.message=R(e,...r),function(e){if(!e.stack)return;const t=e.stack.split("\n");t.splice(1,2),e.stack=t.join("\n")}(this)}},N=function(e,t){if(!e){for(var r=arguments.length,n=new Array(r>2?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];throw new W(t,...n)}};N.as=function(e,t,r){if(!t){const t=null!=e.prototype.name;for(var n=arguments.length,i=new Array(n>3?n-3:0),s=3;s<n;s++)i[s-3]=arguments[s];throw t?new e(R(r,i)):e(R(r,i))}};var B=g(F()),V=window.localStorage.CSB_EMULATOR_DEBUG,H="\x1b[36;1m",z={preview:"\x1b[33;1m",emulator:"\x1b[35;1m",runtime:H,bridge:"\x1b[34m","runtime:worker":H};function J(e){return function(t){if("true"===V){const s=()=>t.includes("sender")?"".concat("\x1b[32;1m","sender"):t.includes("receiver")?"".concat("\x1b[31m","receiver"):"",o=t.replace(/\[.+\]:/,"");for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];console.debug("".concat(z[e]).concat(e,":").concat(s()).concat("\x1b[0m",":").concat(o),...n)}}}var q=J("emulator"),G=class{constructor(e){a(this,"emitter",void 0),a(this,"channel",void 0),a(this,"receiverPort",void 0),a(this,"receiverReadyPromise",void 0),this.target=e,this.emitter=new EventTarget,this.channel=new MessageChannel,this.receiverPort=this.channel.port1;const t=new B.DeferredPromise,r=e=>{"internal/ready"===e.data.type&&(q("[message-sender]: runtime is ready"),t.resolve())};window.addEventListener("message",r),t.then((()=>{window.removeEventListener("message",r)})),this.receiverReadyPromise=t,this.receiverPort.onmessage=e=>{const t=e.data;null!=t.type&&(q('[message-sender]: emitting "%s" event...',t.type,t.payload),this.emitter.dispatchEvent(new MessageEvent(t.type,{data:t.payload})))}}async handshake(){const e=new B.DeferredPromise;await this.receiverReadyPromise,q("[message-sender]: sending handshake"),this.target.postMessage({type:"internal/handshake"},"*",[this.channel.port2]),this.on("internal/handshake/done",(()=>{e.resolve(),clearTimeout(t)}));const t=setTimeout((()=>{e.reject(new Error("MessageSender: Handshake timeout"))}),5e3);return e}on(e,t,r){q('[message-sender]: add listener "%s"',e),this.emitter.addEventListener(e,(e=>{e instanceof MessageEvent&&t(e)}),r)}off(e,t,r){this.emitter.removeEventListener(e,t,r)}async send(e){const t=new B.DeferredPromise,r=(0,T.default)(),n=(arguments.length<=1?void 0:arguments[1])||{};q('[message-sender]: send "%s" (%s)',e,r,n),this.receiverPort.postMessage({type:e,payload:{operationId:r,payload:n}}),q('[message-sender]: adding done listener for "%s" (%s)',e,r);const i=n=>{const{data:i}=n;if(i.operationId===r){const n=i.listenerPayload||{};q('[message-sender]: resolving "%s (%s) promise!',e,r),t.resolve({...n,operationId:i.operationId})}},s=n=>{const{data:i}=n;i.operationId===r&&(q('[message-sender]: rejecting "%s (%s) promise!',e,r),t.reject(i.error))};return this.on("internal/operation/done",i),this.on("internal/operation/failed",s),t.finally((()=>{this.emitter.removeEventListener("internal/operation/done",i),this.emitter.removeEventListener("internal/operation/failed",s)}))}},K=g(F()),$=g(C()),Q=class{constructor(e){this.channel=e}async init(e){await this.channel.send("fs/init",{files:e})}async readFile(e,t){const r=await this.channel.send("fs/readFile",{path:e,encoding:t}).catch((t=>{throw new Error(R('Failed to read file at path "%s"',e),{cause:t})}));if(!r)throw new Error("File not found");return r.data}async writeFile(e,t,r){let n,i=!1;"object"===typeof r?(n=r.encoding,i=!!r.recursive):"string"===typeof r&&(n=r),await this.channel.send("fs/writeFile",{path:e,content:t,encoding:n,recursive:i}).catch((t=>{throw new Error(R('Failed to write file at path "%s"',e),{cause:t})}))}async readdir(e){const t=await this.channel.send("fs/readdir",{path:e}).catch((t=>{throw new Error(R('Failed to read directory at path "%s"',e),{cause:t})}));if(!t)throw new Error("Directory not found");return t.data}async mkdir(e,t){const r=!(null===t||void 0===t||!t.recursive);await this.channel.send("fs/mkdir",{path:e,recursive:r}).catch((t=>{throw new Error(R('Failed to make directory at path "%s"',e),{cause:t})}))}async stat(e){const t=await this.channel.send("fs/stat",{path:e}).catch((t=>{throw new Error(R('Failed to stat file at path "%s"',e),{cause:t})}));if(!t)throw new Error("File not found");return t.data}async rm(e,t){const{force:r,recursive:n}=t||{};await this.channel.send("fs/rm",{path:e,force:r,recursive:n}).catch((t=>{throw new Error(R('Failed to remove file at path "%s"',e),{cause:t})}))}async watch(e,t,r){const n=(0,$.default)();return await this.channel.send("fs/watch",{watcherId:n,includes:e,excludes:t}),this.channel.on("fs/watch-event",(e=>{let{data:t}=e;if(t.watcherId===n&&r){const e={...t};delete e.watcherId,r(e)}})),{dispose:()=>this.channel.send("fs/unwatch",{watcherId:n})}}},X=g(D()),Y=class{constructor(e){this.channel=e}create(){return new Z(this.channel)}},Z=class{constructor(e){a(this,"id",void 0),a(this,"state",void 0),a(this,"stdout",void 0),a(this,"stderr",void 0),a(this,"stdin",void 0),this.channel=e,this.state="running",this.stdout=new X.Emitter,this.stderr=new X.Emitter,this.stdin={write:e=>{if(!this.id)throw new Error("Failed to write to stdin, no process is currently running");return this.channel.send("shell/stdin",{data:e,workerId:this.id})}},this.forwardStdEvents()}forwardStdEvents(){this.channel.on("worker/tty",(e=>{const{data:t}=e;if(t.workerId===this.id)switch(t.payload.type){case"out":this.stdout.emit("data",t.payload.data);break;case"err":this.stderr.emit("data",t.payload.data)}}))}async runCommand(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};N(!this.id,'Failed to run "runCommand" on a ShellProcess: there is already a process running.');const n=await this.channel.send("shell/runCommand",{command:e,args:t,options:r});return N(n,'Failed to run "runCommand" on a ShellProcess: was not able to retrieve a running process.'),this.id=n.id,this.state="running",n}async on(e,t){switch(e){case"progress":return void this.channel.on("worker/progress",(e=>{let{data:r}=e;t(r.status)}));case"exit":return void this.channel.on("worker/exit",(e=>{let{data:r}=e;r.workerId===this.id&&t(r.exitCode,r.error)}))}}async kill(){N(this.id,'Failed to run "kill" on a ShellProcess: there is no process running. Did you forget to run it?'),this.state="idle",await this.channel.send("shell/exit",{id:this.id}).catch((e=>{throw new Error(R('Failed to kill shell with ID "%s"',this.id),{cause:e})})),this.id=void 0}},ee=g(F()),te=class{constructor(e){this.channel=e}async waitFor(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2e4;const n=new ee.DeferredPromise,i=setTimeout((()=>{n.reject()}),r),s=await this.channel.send("preview/get/info",e).catch((t=>{n.reject(new Error(R('Failed to look up preview information for shell ID "%s" (port: %d)',e.sourceShellId,e.port)))})),o=s&&t(s);return o&&n.resolve({url:s.url,port:s.port,sourceShellId:s.sourceShellId}),this.channel.on("preview/port/ready",(e=>{let{data:r}=e;!o&&t(r)&&n.resolve({url:r.url,port:r.port,sourceShellId:r.sourceShellId})})),n.finally((()=>{clearTimeout(i)}))}async getByShellId(e,t){return this.waitFor({sourceShellId:e},(t=>t.sourceShellId===e),t).catch((t=>{throw new Error(R('Failed to get shell by ID "%s"',e),{cause:t})}))}async waitForPort(e,t){return this.waitFor({port:e},(t=>t.port===e),t).catch((t=>{throw new Error(R("Failed to await port %d",e),{cause:t})}))}},re=J("emulator"),ne=class{constructor(e){a(this,"channel",null),a(this,"isConnected",void 0),a(this,"url",void 0),a(this,"fileSystemApi",null),a(this,"shellApi",null),a(this,"previewApi",null),this.options=e,N(this.options.iframe,'Failed to create a Nodebox: expected "iframe" argument to be a reference to an <iframe> element but got %j',this.options.iframe),this.url=this.options.runtimeUrl||"https://nodebox-runtime.codesandbox.io",this.isConnected=!1}async connect(){const{iframe:e,cdnUrl:t}=this.options;re("[message-sender]: Connecting to node emulator...");const r=new K.DeferredPromise;this.url||r.reject(new Error("Nodebox URL is missing. Did you forget to provide it when creating this Nodebox instance?")),N(e.contentWindow,"Failed to create a MessageChannel with the Nodebox iframe: no content window found"),this.channel=new G(e.contentWindow);const n=new K.DeferredPromise;return e.setAttribute("src",this.url),e.addEventListener("load",(()=>{n.resolve()}),{once:!0}),e.addEventListener("error",(e=>{n.reject(e.error)}),{once:!0}),await n,re("[message-sender]: IFrame loaded..."),await this.channel.handshake(),re("[message-sender]: Handshake completed..."),this.channel.send("connect",{cdnUrl:t}),this.channel.on("runtime/ready",(()=>{r.resolve()})),r.then((()=>{re("[message-sender]: Connected to runtime..."),this.isConnected=!0}))}get fs(){return N(this.isConnected,'Failed to access the File System API: consumer is not connected. Did you forget to run "connect()"?'),this.fileSystemApi||(this.fileSystemApi=new Q(this.channel)),this.fileSystemApi}get shell(){return N(this.isConnected,'Failed to access the Shell API: consumer is not connected. Did you forget to run "connect()"?'),this.shellApi||(this.shellApi=new Y(this.channel)),this.shellApi}get preview(){return N(this.isConnected,'Failed to access the Preview API: consumer is not connected. Did you forget to run "connect()"?'),this.previewApi||(this.previewApi=new te(this.channel)),this.previewApi}},ie=r(84),se=r(614);r(888),r(504);function oe(e,t){return(0,n._)(this,void 0,void 0,(function(){var r,i,s;return(0,n.a)(this,(function(o){return r=e.contentWindow,(0,n.n)(r,"Failed to await preview iframe: no content window found"),9e4,20,i=0,[2,new Promise((function(r,o){var a=function(){var c=function(){clearTimeout(s),i=20,r(),e.removeEventListener("load",c)};i>=20?o((0,n.c)("Could not able to connect to preview.")):(e.setAttribute("src",t),s=setTimeout((function(){a(),e.removeEventListener("load",c)}),9e4),i+=1,e.addEventListener("load",c))};e.addEventListener("error",(function(){return o(new Error("Iframe error"))})),e.addEventListener("abort",(function(){return o(new Error("Aborted"))})),a()}))]}))}))}var ae=[{code:function(e){var t=e.scope,r=window.history.__proto__,n=[],i=0,s=function(e){parent.postMessage({type:"urlchange",url:e,back:i>0,forward:i<n.length-1,channelId:t.channelId},"*")};Object.assign(window.history,{go:function(e){var t=i+e;if(t>=0&&t<=n.length-1){var o=n[i=t],a=o.url,c=o.state;r.replaceState.call(window.history,c,"",a);var l=document.location.href;s(l),window.dispatchEvent(new PopStateEvent("popstate",{state:c}))}},back:function(){window.history.go(-1)},forward:function(){window.history.go(1)},pushState:function(e,t,o){r.replaceState.call(window.history,e,t,o),function(e,t){n.splice(i+1),n.push({url:e,state:t}),i=n.length-1}(o,e),s(document.location.href)},replaceState:function(e,t,o){r.replaceState.call(window.history,e,t,o),n[i]={state:e,url:o},s(document.location.href)}}),window.addEventListener("message",(function(e){var t=e.data;"urlback"===t.type?history.back():"urlforward"===t.type?history.forward():"refresh"===t.type&&document.location.reload()}))}.toString(),id:"historyListener"},{code:"function consoleHook({ scope }) {"+se.c+"\n};",id:"consoleHook"}],ce=function(e){function t(t,r,i){void 0===i&&(i={});var s=e.call(this,t,r,(0,n.h)((0,n.h)({},i),{bundlerURL:i.bundlerURL}))||this;return s._modulesCache=new Map,s.messageChannelId=(0,se.g)(),s._initPromise=null,s.emitter=new se.E,s.manageIframes(t),s.emulator=new ne({iframe:s.emulatorIframe,runtimeUrl:s.options.bundlerURL}),s.updateSandbox(r),s}return(0,n.g)(t,e),t.prototype._init=function(e){return(0,n._)(this,void 0,void 0,(function(){return(0,n.a)(this,(function(t){switch(t.label){case 0:return[4,this.emulator.connect()];case 1:return t.sent(),[4,this.emulator.fs.init(e)];case 2:return t.sent(),[4,this.globalListeners()];case 3:return t.sent(),[2]}}))}))},t.prototype.compile=function(e){return(0,n._)(this,void 0,void 0,(function(){var t,r;return(0,n.a)(this,(function(n){switch(n.label){case 0:return n.trys.push([0,5,,6]),this.status="initializing",this.dispatch({type:"start",firstLoad:!0}),this._initPromise||(this._initPromise=this._init(e)),[4,this._initPromise];case 1:return n.sent(),this.dispatch({type:"connected"}),[4,this.createShellProcessFromTask(e)];case 2:return t=n.sent().id,[4,this.createPreviewURLFromId(t)];case 3:return n.sent(),[4,this.setLocationURLIntoIFrame()];case 4:return n.sent(),this.dispatchDoneMessage(),[3,6];case 5:return r=n.sent(),this.dispatch({type:"action",action:"notification",notificationType:"error",title:(0,se.a)(r)}),this.dispatch({type:"done",compilatonError:!0}),[3,6];case 6:return[2]}}))}))},t.prototype.createShellProcessFromTask=function(e){return(0,n._)(this,void 0,void 0,(function(){var t,r,i=this;return(0,n.a)(this,(function(s){switch(s.label){case 0:return t=(0,se.r)(e["/package.json"]),this.emulatorCommand=(0,se.b)(t),this.emulatorShellProcess=this.emulator.shell.create(),[4,this.emulatorShellProcess.on("exit",(function(e){i.dispatch({type:"action",action:"notification",notificationType:"error",title:(0,n.c)("Error: process.exit("+e+") called.")})}))];case 1:return s.sent(),[4,this.emulatorShellProcess.on("progress",(function(e){var t,r;if("command_running"===e.state||"starting_command"===e.state)return i.dispatch({type:"shell/progress",data:(0,n.h)((0,n.h)({},e),{command:[null===(t=i.emulatorCommand)||void 0===t?void 0:t[0],null===(r=i.emulatorCommand)||void 0===r?void 0:r[1].join(" ")].join(" ")})}),void(i.status="installing-dependencies");i.dispatch({type:"shell/progress",data:e})}))];case 2:return s.sent(),this.emulatorShellProcess.stdout.on("data",(function(e){i.dispatch({type:"stdout",payload:{data:e,type:"out"}})})),this.emulatorShellProcess.stderr.on("data",(function(e){i.dispatch({type:"stdout",payload:{data:e,type:"err"}})})),[4,(r=this.emulatorShellProcess).runCommand.apply(r,this.emulatorCommand)];case 3:return[2,s.sent()]}}))}))},t.prototype.createPreviewURLFromId=function(e){var t;return(0,n._)(this,void 0,void 0,(function(){var r;return(0,n.a)(this,(function(n){switch(n.label){case 0:return this.iframePreviewUrl=void 0,[4,this.emulator.preview.getByShellId(e)];case 1:return r=n.sent().url,this.iframePreviewUrl=null!==(t=r+this.options.startRoute)&&void 0!==t?t:"",[2]}}))}))},t.prototype.manageIframes=function(e){var t,r,i;if("string"===typeof e){var s=document.querySelector(e);(0,n.n)(s,"The element '"+e+"' was not found"),this.iframe=document.createElement("iframe")}else this.iframe=e;r=this.iframe,i=this.options,r.style.border="0",r.style.width=i.width||"100%",r.style.height=i.height||"100%",r.style.overflow="hidden",r.allow="cross-origin-isolated",(0,n.n)(this.iframe.parentNode,"The given iframe does not have a parent."),this.emulatorIframe=document.createElement("iframe"),this.emulatorIframe.classList.add("sp-bridge-frame"),null===(t=this.iframe.parentNode)||void 0===t||t.appendChild(this.emulatorIframe)},t.prototype.setLocationURLIntoIFrame=function(){return(0,n._)(this,void 0,void 0,(function(){return(0,n.a)(this,(function(e){switch(e.label){case 0:return this.iframePreviewUrl?[4,oe(this.iframe,this.iframePreviewUrl)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},t.prototype.dispatchDoneMessage=function(){this.status="done",this.dispatch({type:"done",compilatonError:!1}),this.iframePreviewUrl&&this.dispatch({type:"urlchange",url:this.iframePreviewUrl,back:!1,forward:!1})},t.prototype.globalListeners=function(){return(0,n._)(this,void 0,void 0,(function(){var e=this;return(0,n.a)(this,(function(t){switch(t.label){case 0:return window.addEventListener("message",(function(t){var r,n;"PREVIEW_LOADED"===t.data.type&&(r=e.iframe,n=e.messageChannelId,ae.forEach((function(e){var t,i=e.code,s={uid:e.id,type:"INJECT_AND_INVOKE",code:"exports.activate = "+i,scope:{channelId:n}};null===(t=r.contentWindow)||void 0===t||t.postMessage(s,"*")}))),"urlchange"===t.data.type&&t.data.channelId===e.messageChannelId?e.dispatch({type:"urlchange",url:t.data.url,back:t.data.back,forward:t.data.forward}):t.data.channelId===e.messageChannelId&&e.dispatch(t.data)})),[4,this.emulator.fs.watch(["*"],[".next","node_modules","build","dist","vendor",".config",".vuepress"],(function(t){return(0,n._)(e,void 0,void 0,(function(){var e,r,i,s,o;return(0,n.a)(this,(function(n){switch(n.label){case 0:return t?(r="newPath"in(e=t)?e.newPath:"path"in e?e.path:"",[4,this.emulator.fs.stat(r)]):[2];case 1:if("file"!==n.sent().type)return[2,null];n.label=2;case 2:switch(n.trys.push([2,10,,11]),e.type){case"change":case"create":return[3,3];case"remove":return[3,5];case"rename":return[3,6];case"close":return[3,8]}return[3,9];case 3:return[4,this.emulator.fs.readFile(e.path,"utf8")];case 4:return i=n.sent(),this.dispatch({type:"fs/change",path:e.path,content:i}),this._modulesCache.set(e.path,(0,se.w)(i)),[3,9];case 5:return this.dispatch({type:"fs/remove",path:e.path}),this._modulesCache.delete(e.path),[3,9];case 6:return this.dispatch({type:"fs/remove",path:e.oldPath}),this._modulesCache.delete(e.oldPath),[4,this.emulator.fs.readFile(e.newPath,"utf8")];case 7:return s=n.sent(),this.dispatch({type:"fs/change",path:e.newPath,content:s}),this._modulesCache.set(e.newPath,(0,se.w)(s)),[3,9];case 8:return[3,9];case 9:return[3,11];case 10:return o=n.sent(),this.dispatch({type:"action",action:"notification",notificationType:"error",title:(0,se.a)(o)}),[3,11];case 11:return[2]}}))}))}))];case 1:return t.sent(),[2]}}))}))},t.prototype.restartShellProcess=function(){var e;return(0,n._)(this,void 0,void 0,(function(){return(0,n.a)(this,(function(t){switch(t.label){case 0:return this.emulatorShellProcess&&this.emulatorCommand?(this.dispatch({type:"start",firstLoad:!0}),this.status="initializing",[4,this.emulatorShellProcess.kill()]):[3,3];case 1:return t.sent(),null===(e=this.iframe)||void 0===e||e.removeAttribute("attr"),this.emulator.fs.rm("/node_modules/.vite",{recursive:!0,force:!0}),[4,this.compile(Object.fromEntries(this._modulesCache))];case 2:t.sent(),t.label=3;case 3:return[2]}}))}))},t.prototype.updateSandbox=function(e){var t,r=this,n=(0,se.f)(e.files);"running"!==(null===(t=this.emulatorShellProcess)||void 0===t?void 0:t.state)?(this.dispatch({codesandbox:!0,modules:n,template:e.template,type:"compile"}),Object.entries(n).forEach((function(e){var t=e[0],n=e[1];r._modulesCache.set(t,(0,se.w)(n))}))):Object.entries(n).forEach((function(e){var t=e[0],n=e[1];r._modulesCache.get(t)&&(0,se.r)(n)===(0,se.r)(r._modulesCache.get(t))||r.emulator.fs.writeFile(t,n,{recursive:!0})}))},t.prototype.dispatch=function(e){var t,r;return(0,n._)(this,void 0,void 0,(function(){return(0,n.a)(this,(function(n){switch(n.label){case 0:switch(e.type){case"compile":return[3,1];case"refresh":return[3,2];case"urlback":case"urlforward":return[3,4];case"shell/restart":return[3,5];case"shell/openPreview":return[3,6]}return[3,7];case 1:return this.compile(e.modules),[3,8];case 2:return[4,this.setLocationURLIntoIFrame()];case 3:return n.sent(),[3,8];case 4:return null===(r=null===(t=this.iframe)||void 0===t?void 0:t.contentWindow)||void 0===r||r.postMessage(e,"*"),[3,8];case 5:return this.restartShellProcess(),[3,8];case 6:return window.open(this.iframePreviewUrl,"_blank"),[3,8];case 7:this.emitter.dispatch(e),n.label=8;case 8:return[2]}}))}))},t.prototype.listen=function(e){return this.emitter.listener(e)},t.prototype.destroy=function(){this.emulatorIframe.remove(),this.emitter.cleanup()},t}(ie.S)}}]);
//# sourceMappingURL=100.3d76a28c.chunk.js.map